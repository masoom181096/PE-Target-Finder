import type {
  RiskBucketId,
  RiskBucketDefinition,
  RiskSubClauseDefinition,
  CompanyRiskScores,
  RiskGrade,
} from "@shared/schema";

export const RISK_BUCKETS: RiskBucketDefinition[] = [
  { id: "liability", label: "Liability", weightPercent: 25, maxScore: 13 },
  { id: "nonSolicitation", label: "Non-Solicitation", weightPercent: 5, maxScore: 4 },
  { id: "termination", label: "Termination", weightPercent: 20, maxScore: 17 },
  { id: "personnel", label: "Personnel", weightPercent: 5, maxScore: 5 },
  { id: "stepIn", label: "Step-in", weightPercent: 7, maxScore: 4 },
  { id: "penalty", label: "Penalty / LDs", weightPercent: 5, maxScore: 3 },
  { id: "nonCompete", label: "Non-compete", weightPercent: 10, maxScore: 7 },
  { id: "confidentiality", label: "Confidentiality", weightPercent: 20, maxScore: 3 },
  { id: "paymentTerms", label: "Payment Terms", weightPercent: 5, maxScore: 7 },
  { id: "intellectualProperty", label: "Intellectual Property", weightPercent: 10, maxScore: 4 },
  { id: "indemnities", label: "Indemnities", weightPercent: 10, maxScore: 5 },
];

export const RISK_SUBCLAUSES: RiskSubClauseDefinition[] = [
  {
    id: "liability_directDamages",
    bucketId: "liability",
    label: "Direct damages cap",
    maxScore: 3,
    options: [
      { score: 1, description: "Liability ≤ 24 months of fees or ≤ 3x SOW value" },
      { score: 2, description: "Liability > 24 months of fees or > 3x SOW value" },
      { score: 3, description: "Completely uncapped / unlimited liability" },
    ],
  },
  {
    id: "liability_indirectDamages",
    bucketId: "liability",
    label: "Indirect damages carve-out",
    maxScore: 4,
    options: [
      { score: 1, description: "Indirect damages fully carved out" },
      { score: 2, description: "Carved out only for PI/death/property/fraud/misconduct/applicable law" },
      { score: 3, description: "Carved out for IP/Data/Confidentiality etc but linked to direct cap" },
      { score: 4, description: "No carve-out for indirect damages" },
    ],
  },
  {
    id: "liability_grossNegligence",
    bucketId: "liability",
    label: "Gross negligence / willful misconduct",
    maxScore: 3,
    options: [
      { score: 1, description: "Standard exclusion for gross negligence and willful misconduct" },
      { score: 2, description: "Limited exclusion with specific carve-outs" },
      { score: 3, description: "No exclusion - full liability exposure" },
    ],
  },
  {
    id: "liability_dataProtection",
    bucketId: "liability",
    label: "Data protection liability",
    maxScore: 3,
    options: [
      { score: 1, description: "Capped at direct damages limit" },
      { score: 2, description: "Higher cap for data breaches (2x direct damages)" },
      { score: 3, description: "Uncapped liability for data breaches" },
    ],
  },
  {
    id: "nonSolicitation_employees",
    bucketId: "nonSolicitation",
    label: "Employee non-solicitation",
    maxScore: 2,
    options: [
      { score: 1, description: "12-month mutual non-solicitation period" },
      { score: 2, description: "24+ month or one-sided non-solicitation" },
    ],
  },
  {
    id: "nonSolicitation_customers",
    bucketId: "nonSolicitation",
    label: "Customer non-solicitation",
    maxScore: 2,
    options: [
      { score: 1, description: "No customer non-solicitation or limited scope" },
      { score: 2, description: "Broad customer non-solicitation restrictions" },
    ],
  },
  {
    id: "termination_convenience",
    bucketId: "termination",
    label: "Termination for convenience",
    maxScore: 4,
    options: [
      { score: 1, description: "90+ days notice, mutual right" },
      { score: 2, description: "60 days notice, mutual right" },
      { score: 3, description: "30 days notice or client-only right" },
      { score: 4, description: "Immediate termination right for client" },
    ],
  },
  {
    id: "termination_forCause",
    bucketId: "termination",
    label: "Termination for cause / breach",
    maxScore: 4,
    options: [
      { score: 1, description: "30-day cure period for material breach" },
      { score: 2, description: "15-day cure period for material breach" },
      { score: 3, description: "7-day cure period or no cure for specified breaches" },
      { score: 4, description: "Immediate termination, no cure period" },
    ],
  },
  {
    id: "termination_windDown",
    bucketId: "termination",
    label: "Transition / wind-down obligations",
    maxScore: 3,
    options: [
      { score: 1, description: "Reasonable transition period with additional fees" },
      { score: 2, description: "Extended transition at reduced rates" },
      { score: 3, description: "Extended transition at no additional cost" },
    ],
  },
  {
    id: "termination_paymentOnTermination",
    bucketId: "termination",
    label: "Payment on termination",
    maxScore: 3,
    options: [
      { score: 1, description: "Full payment for work completed plus wind-down costs" },
      { score: 2, description: "Pro-rata payment only" },
      { score: 3, description: "Client may withhold payments pending resolution" },
    ],
  },
  {
    id: "termination_ipReturn",
    bucketId: "termination",
    label: "IP and data return obligations",
    maxScore: 3,
    options: [
      { score: 1, description: "Standard return/destruction with reasonable timeline" },
      { score: 2, description: "Immediate return with certification requirements" },
      { score: 3, description: "Immediate transfer of all work product including tools" },
    ],
  },
  {
    id: "personnel_keyPerson",
    bucketId: "personnel",
    label: "Key personnel requirements",
    maxScore: 3,
    options: [
      { score: 1, description: "Named resources with reasonable replacement process" },
      { score: 2, description: "Approval required for key personnel changes" },
      { score: 3, description: "Client approval for any personnel changes" },
    ],
  },
  {
    id: "personnel_backgroundChecks",
    bucketId: "personnel",
    label: "Background check requirements",
    maxScore: 2,
    options: [
      { score: 1, description: "Standard background checks at provider cost" },
      { score: 2, description: "Enhanced checks with ongoing monitoring at provider cost" },
    ],
  },
  {
    id: "stepIn_rights",
    bucketId: "stepIn",
    label: "Step-in rights scope",
    maxScore: 4,
    options: [
      { score: 1, description: "No step-in rights or limited to insolvency" },
      { score: 2, description: "Step-in for material breach with 30-day notice" },
      { score: 3, description: "Step-in for service failures with 15-day notice" },
      { score: 4, description: "Broad step-in rights with minimal notice" },
    ],
  },
  {
    id: "penalty_serviceLevels",
    bucketId: "penalty",
    label: "Service level penalties",
    maxScore: 3,
    options: [
      { score: 1, description: "Service credits capped at 10-15% of monthly fees" },
      { score: 2, description: "Service credits up to 25% of monthly fees" },
      { score: 3, description: "Uncapped service credits or additional penalties" },
    ],
  },
  {
    id: "nonCompete_scope",
    bucketId: "nonCompete",
    label: "Non-compete scope",
    maxScore: 4,
    options: [
      { score: 1, description: "No non-compete or limited to specific project scope" },
      { score: 2, description: "Industry sector restrictions for 12 months" },
      { score: 3, description: "Broad sector restrictions for 18-24 months" },
      { score: 4, description: "Extensive restrictions covering related sectors" },
    ],
  },
  {
    id: "nonCompete_geography",
    bucketId: "nonCompete",
    label: "Non-compete geography",
    maxScore: 3,
    options: [
      { score: 1, description: "Limited to specific markets/regions" },
      { score: 2, description: "National scope" },
      { score: 3, description: "Global scope" },
    ],
  },
  {
    id: "confidentiality_term",
    bucketId: "confidentiality",
    label: "Confidentiality term",
    maxScore: 3,
    options: [
      { score: 1, description: "3-5 years post-termination" },
      { score: 2, description: "7-10 years post-termination" },
      { score: 3, description: "Perpetual confidentiality obligations" },
    ],
  },
  {
    id: "paymentTerms_timing",
    bucketId: "paymentTerms",
    label: "Payment timing",
    maxScore: 4,
    options: [
      { score: 1, description: "Net 30 days from invoice" },
      { score: 2, description: "Net 45 days from invoice" },
      { score: 3, description: "Net 60 days from invoice" },
      { score: 4, description: "Net 90+ days from invoice" },
    ],
  },
  {
    id: "paymentTerms_disputes",
    bucketId: "paymentTerms",
    label: "Payment dispute resolution",
    maxScore: 3,
    options: [
      { score: 1, description: "Only disputed portion may be withheld" },
      { score: 2, description: "Full invoice may be withheld pending resolution" },
      { score: 3, description: "Client may offset against other obligations" },
    ],
  },
  {
    id: "intellectualProperty_ownership",
    bucketId: "intellectualProperty",
    label: "IP ownership",
    maxScore: 2,
    options: [
      { score: 1, description: "Provider retains pre-existing IP, work product assigned" },
      { score: 2, description: "All IP including tools and methodologies assigned to client" },
    ],
  },
  {
    id: "intellectualProperty_licensing",
    bucketId: "intellectualProperty",
    label: "IP licensing terms",
    maxScore: 2,
    options: [
      { score: 1, description: "Limited license for project-specific use" },
      { score: 2, description: "Broad perpetual license with sublicensing rights" },
    ],
  },
  {
    id: "indemnities_scope",
    bucketId: "indemnities",
    label: "Indemnification scope",
    maxScore: 3,
    options: [
      { score: 1, description: "Limited to IP infringement and gross negligence" },
      { score: 2, description: "Includes breach of representations and data protection" },
      { score: 3, description: "Broad indemnity including consequential damages" },
    ],
  },
  {
    id: "indemnities_cap",
    bucketId: "indemnities",
    label: "Indemnification cap",
    maxScore: 2,
    options: [
      { score: 1, description: "Capped at liability limit" },
      { score: 2, description: "Uncapped or significantly higher than liability limit" },
    ],
  },
];

export const COMPANY_RISK_SCORES: Record<string, Record<string, number>> = {
  mantla: {
    liability_directDamages: 2,
    liability_indirectDamages: 2,
    liability_grossNegligence: 1,
    liability_dataProtection: 2,
    nonSolicitation_employees: 1,
    nonSolicitation_customers: 1,
    termination_convenience: 2,
    termination_forCause: 2,
    termination_windDown: 1,
    termination_paymentOnTermination: 2,
    termination_ipReturn: 1,
    personnel_keyPerson: 2,
    personnel_backgroundChecks: 1,
    stepIn_rights: 2,
    penalty_serviceLevels: 2,
    nonCompete_scope: 2,
    nonCompete_geography: 1,
    confidentiality_term: 2,
    paymentTerms_timing: 2,
    paymentTerms_disputes: 1,
    intellectualProperty_ownership: 1,
    intellectualProperty_licensing: 1,
    indemnities_scope: 2,
    indemnities_cap: 1,
  },
  instaworks: {
    liability_directDamages: 1,
    liability_indirectDamages: 2,
    liability_grossNegligence: 1,
    liability_dataProtection: 1,
    nonSolicitation_employees: 1,
    nonSolicitation_customers: 1,
    termination_convenience: 1,
    termination_forCause: 2,
    termination_windDown: 1,
    termination_paymentOnTermination: 1,
    termination_ipReturn: 1,
    personnel_keyPerson: 1,
    personnel_backgroundChecks: 1,
    stepIn_rights: 1,
    penalty_serviceLevels: 1,
    nonCompete_scope: 2,
    nonCompete_geography: 1,
    confidentiality_term: 1,
    paymentTerms_timing: 2,
    paymentTerms_disputes: 1,
    intellectualProperty_ownership: 1,
    intellectualProperty_licensing: 1,
    indemnities_scope: 1,
    indemnities_cap: 1,
  },
  disprztech: {
    liability_directDamages: 2,
    liability_indirectDamages: 2,
    liability_grossNegligence: 2,
    liability_dataProtection: 2,
    nonSolicitation_employees: 2,
    nonSolicitation_customers: 1,
    termination_convenience: 2,
    termination_forCause: 2,
    termination_windDown: 2,
    termination_paymentOnTermination: 2,
    termination_ipReturn: 2,
    personnel_keyPerson: 2,
    personnel_backgroundChecks: 1,
    stepIn_rights: 2,
    penalty_serviceLevels: 2,
    nonCompete_scope: 2,
    nonCompete_geography: 2,
    confidentiality_term: 2,
    paymentTerms_timing: 2,
    paymentTerms_disputes: 2,
    intellectualProperty_ownership: 2,
    intellectualProperty_licensing: 1,
    indemnities_scope: 2,
    indemnities_cap: 1,
  },
};

export function getRiskBucketById(id: RiskBucketId): RiskBucketDefinition | undefined {
  return RISK_BUCKETS.find((b) => b.id === id);
}

export function getSubclausesByBucket(bucketId: RiskBucketId): RiskSubClauseDefinition[] {
  return RISK_SUBCLAUSES.filter((sc) => sc.bucketId === bucketId);
}
