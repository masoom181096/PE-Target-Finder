Patch prompt for your dev / Replit agent
üîß High-level instruction
Update the existing PE Target Finder project with the following enhancements.
Keep all existing phases and components, but extend them as described.
A. Insert Macro/Micro/Fund-Restriction Step (5‚Äì8)
1. New Phase
Add a new phase into the state machine between fundMandate and countryScreening:
type Phase =
  | "welcome"
  | "fundMandate"
  | "restrictions"      // NEW
  | "countryScreening"
  | "weights"
  | "thresholds"
  | "shortlist"
  | "comparison"
  | "reportChosen";
Extend ConversationState:
interface Restrictions {
  avoidSanctionedCountries?: boolean;
  notes?: string; // free text, e.g. "Avoid US sanctioned countries"
}
interface ConversationState {
  // ...
  restrictions: Restrictions;
}
2. Chat Flow
After mandate is captured and the user says ‚ÄúOK please proceed‚Äù, switch to phase = "restrictions" and send this assistant prompt:
‚ÄúBefore moving ahead, do you want to add any Macro / Micro / Fund restrictions, or I can assess macro conditions, micro and fund restrictions along with the provided fund mandate?‚Äù
If user types something like ‚ÄúYes, Avoid US sanctioned countries‚Äù:
Set restrictions.avoidSanctionedCountries = true
Set restrictions.notes = "Avoid US sanctioned countries"
If user says ‚ÄúNo‚Äù, just leave restrictions empty.
Then always (regardless of yes/no) produce a fixed macro/micro/mandate-compatibility summary and move to countryScreening.
Use exactly this content in the assistant message:
Macro Analysis
‚Ä¢ India: Strong technology growth, robust GDP, favourable regulation
‚Ä¢ Singapore: Best for high-quality, governance-heavy deals, fastest-growing technology base
‚Ä¢ Vietnam: Fastest-growing technology base.
These markets demonstrate strong tech demand.
Micro Analysis
‚Ä¢ India & Singapore show better growth economics than Vietnam.
Mandate Compatibility Check
‚Ä¢ All three markets have companies with ticket size above USD 50M.
‚Ä¢ ESG environment: strongest in India & Singapore.
‚Ä¢ Government revenue dependency risk highest in Vietnam (but controllable).
Overall, macro, micro and mandate alignment is strongest in India and Singapore.
Also add corresponding thinking steps:
‚ÄúAssessing macro conditions across India, Singapore, Vietnam based on demo Refinitiv / CIQ data‚Ä¶‚Äù
‚ÄúComparing unit economics and growth profiles to your mandate‚Ä¶‚Äù
‚ÄúIdentifying India and Singapore as strongest fits given your ticket size and ESG preferences‚Ä¶‚Äù
Then go to phase = "countryScreening" as before.
B. Make ‚ÄúAgent Thinking‚Äù Typewriter-Style Streaming
Right now you probably render each thinkingStep.text as a full string. Change the frontend so each step animates character by character.
Keep backend the same (thinkingSteps: ThinkingStep[] with full text).
In the frontend ThinkingPanel, for each new step:
Store the full text and a displayedText.
Use a useEffect hook + setInterval to append characters gradually.
Example (simplified) pattern:
const [visibleSteps, setVisibleSteps] = useState<DisplayedStep[]>([]);
// DisplayedStep = { id, fullText, shownText }
useEffect(() => {
  // whenever new thinkingSteps arrive from backend:
  // merge them into visibleSteps with shownText = ""
}, [serverThinkingSteps]);
useEffect(() => {
  const interval = setInterval(() => {
    setVisibleSteps(prev =>
      prev.map(step => {
        if (step.shownText.length < step.fullText.length) {
          const nextLen = step.shownText.length + 1;
          return {
            ...step,
            shownText: step.fullText.slice(0, nextLen),
          };
        }
        return step;
      })
    );
  }, 15); // 10‚Äì30ms gives a nice typewriter feel
  return () => clearInterval(interval);
}, []);
Render step.shownText instead of step.fullText.
This way the Agent Thinking panel visibly types out its thoughts rather than popping them in.
C. Add ALL Sub-Parameters from the Matrix
Use the screenshot matrix as the master list of sub-parameters, grouped under the 10 main parameters:
Top-level parameters (already in your scoring model):
Quality of Earnings and Financial Health
Company Financial Performance
Industry Attractiveness
Competitive Positioning
Management Team & Governance
Operational Efficiency
Customer & Market Dynamics
Product / Service Strength
Exit Feasibility
Scalability Potential
1. Define Sub-Parameter Metadata
Create a new type and constant list:
export type TopLevelParamId =
  | "qualityOfEarnings"
  | "companyFinancial"
  | "industryAttractiveness"
  | "competitivePositioning"
  | "managementGovernance"
  | "operationalEfficiency"
  | "customerMarket"
  | "productStrength"
  | "exitFeasibility"
  | "scalabilityPotential";
export type SubParamType = "numeric" | "qualitative";
export type Direction = "higherIsBetter" | "lowerIsBetter" | "none";
export interface SubParameterDefinition {
  id: string;
  label: string;
  category: TopLevelParamId;
  type: SubParamType;
  direction: Direction;
}
Populate SUB_PARAMETERS: SubParameterDefinition[] with ALL items from your table, e.g.:
export const SUB_PARAMETERS: SubParameterDefinition[] = [
  // Quality of Earnings & Financial Health
  { id: "earningsQuality", label: "Earnings quality (recurring vs. one-time)", category: "qualityOfEarnings", type: "qualitative", direction: "higherIsBetter" },
  { id: "debtLeverage", label: "Debt levels & leverage ratios", category: "qualityOfEarnings", type: "numeric", direction: "lowerIsBetter" },
  { id: "profitabilityVsPeers", label: "Profitability vs. peers", category: "qualityOfEarnings", type: "numeric", direction: "higherIsBetter" },
  { id: "accountingPolicies", label: "Accounting policies and redflags", category: "qualityOfEarnings", type: "qualitative", direction: "none" },
  { id: "workingCapitalCycle", label: "Working capital cycle", category: "qualityOfEarnings", type: "numeric", direction: "lowerIsBetter" },
  { id: "capexIntensity", label: "Capital expenditure", category: "qualityOfEarnings", type: "numeric", direction: "lowerIsBetter" },
  { id: "cacLtv", label: "Customer Acquisition Cost (CAC) & Lifetime Value (LTV)", category: "qualityOfEarnings", type: "numeric", direction: "higherIsBetter" },
  // Company Financial Performance
  { id: "revenueGrowth", label: "Revenue growth (historical + forecast)", category: "companyFinancial", type: "numeric", direction: "higherIsBetter" },
  { id: "margins", label: "Margins (Gross, EBITDA, Net)", category: "companyFinancial", type: "numeric", direction: "higherIsBetter" },
  { id: "cashFlowStability", label: "Cash flow stability", category: "companyFinancial", type: "qualitative", direction: "higherIsBetter" },
  { id: "unitEconomics", label: "Unit economics", category: "companyFinancial", type: "qualitative", direction: "higherIsBetter" },
  // Industry Attractiveness
  { id: "marketSize", label: "Market size", category: "industryAttractiveness", type: "numeric", direction: "higherIsBetter" },
  { id: "industryGrowth", label: "Growth rate", category: "industryAttractiveness", type: "numeric", direction: "higherIsBetter" },
  { id: "competitiveIntensity", label: "Competitive intensity & fragmentation", category: "industryAttractiveness", type: "qualitative", direction: "lowerIsBetter" },
  { id: "regulationBarriers", label: "Regulation & entry barriers", category: "industryAttractiveness", type: "qualitative", direction: "higherIsBetter" },
  { id: "cyclicality", label: "Cyclicality and macro resilience", category: "industryAttractiveness", type: "qualitative", direction: "higherIsBetter" },
  { id: "innovationPace", label: "Innovation pace and technological disruption", category: "industryAttractiveness", type: "qualitative", direction: "higherIsBetter" },
  // Competitive Positioning
  { id: "marketShare", label: "Market share", category: "competitivePositioning", type: "numeric", direction: "higherIsBetter" },
  { id: "uvp", label: "Unique value proposition", category: "competitivePositioning", type: "qualitative", direction: "higherIsBetter" },
  { id: "pricingPower", label: "Pricing power", category: "competitivePositioning", type: "qualitative", direction: "higherIsBetter" },
  { id: "brandStrength", label: "Brand strength", category: "competitivePositioning", type: "qualitative", direction: "higherIsBetter" },
  { id: "barriersToEntry", label: "Barriers to entry", category: "competitivePositioning", type: "qualitative", direction: "higherIsBetter" },
  { id: "customerStickiness", label: "Customer stickiness", category: "competitivePositioning", type: "qualitative", direction: "higherIsBetter" },
  // Management Team & Governance
  { id: "leadershipCredibility", label: "Leadership credibility & track record", category: "managementGovernance", type: "qualitative", direction: "higherIsBetter" },
  { id: "executionCapability", label: "Execution capability", category: "managementGovernance", type: "qualitative", direction: "higherIsBetter" },
  { id: "companyCulture", label: "Company culture", category: "managementGovernance", type: "qualitative", direction: "higherIsBetter" },
  { id: "governanceQuality", label: "Governance quality & transparency", category: "managementGovernance", type: "qualitative", direction: "higherIsBetter" },
  // Operational Efficiency
  { id: "costStructure", label: "Cost structure and optimization levers", category: "operationalEfficiency", type: "qualitative", direction: "higherIsBetter" },
  { id: "processMaturity", label: "Process maturity", category: "operationalEfficiency", type: "qualitative", direction: "higherIsBetter" },
  { id: "supplyChainEfficiency", label: "Supply chain and procurement efficiency", category: "operationalEfficiency", type: "qualitative", direction: "higherIsBetter" },
  { id: "automationPotential", label: "Automation potential", category: "operationalEfficiency", type: "qualitative", direction: "higherIsBetter" },
  { id: "itReadiness", label: "IT systems and digital readiness", category: "operationalEfficiency", type: "qualitative", direction: "higherIsBetter" },
  // Customer & Market Dynamics
  { id: "customerSegmentation", label: "Customer segmentation", category: "customerMarket", type: "qualitative", direction: "higherIsBetter" },
  { id: "customerSatisfaction", label: "Customer satisfaction (NPS, CSAT)", category: "customerMarket", type: "numeric", direction: "higherIsBetter" },
  { id: "churnRate", label: "Churn rate", category: "customerMarket", type: "numeric", direction: "lowerIsBetter" },
  { id: "demandPatterns", label: "Demand patterns", category: "customerMarket", type: "qualitative", direction: "higherIsBetter" },
  { id: "marketShareShifts", label: "Market share shifts", category: "customerMarket", type: "qualitative", direction: "higherIsBetter" },
  // Product / Service Strength
  { id: "productDifferentiation", label: "Product differentiation", category: "productStrength", type: "qualitative", direction: "higherIsBetter" },
  { id: "ipProtection", label: "IP protection", category: "productStrength", type: "qualitative", direction: "higherIsBetter" },
  { id: "techStackQuality", label: "Technology stack quality", category: "productStrength", type: "qualitative", direction: "higherIsBetter" },
  { id: "rdCapabilities", label: "R&D capabilities", category: "productStrength", type: "qualitative", direction: "higherIsBetter" },
  { id: "obsolescenceRisk", label: "Obsolescence risk", category: "productStrength", type: "qualitative", direction: "lowerIsBetter" },
  // Exit Feasibility
  { id: "potentialBuyers", label: "Potential buyers (strategics, other PE funds)", category: "exitFeasibility", type: "qualitative", direction: "higherIsBetter" },
  { id: "ipoReadiness", label: "IPO readiness", category: "exitFeasibility", type: "qualitative", direction: "higherIsBetter" },
  { id: "valuationGrowthPotential", label: "Valuation growth potential", category: "exitFeasibility", type: "qualitative", direction: "higherIsBetter" },
  { id: "comparableMultiples", label: "Comparable transaction multiples", category: "exitFeasibility", type: "qualitative", direction: "higherIsBetter" },
  { id: "industryMaTrends", label: "Industry M&A trends", category: "exitFeasibility", type: "qualitative", direction: "higherIsBetter" },
  { id: "timeToExit", label: "Time to exit", category: "exitFeasibility", type: "numeric", direction: "lowerIsBetter" },
  // Scalability Potential
  { id: "businessModelScalability", label: "Business model scalability", category: "scalabilityPotential", type: "qualitative", direction: "higherIsBetter" },
  { id: "operationalScalability", label: "Operational scalability", category: "scalabilityPotential", type: "qualitative", direction: "higherIsBetter" },
  { id: "productReplicability", label: "Product replicability", category: "scalabilityPotential", type: "qualitative", direction: "higherIsBetter" },
  { id: "geoExpansionCapacity", label: "Geographic expansion capacity", category: "scalabilityPotential", type: "qualitative", direction: "higherIsBetter" },
  { id: "crossSellUpsell", label: "Cross-selling & upselling opportunities", category: "scalabilityPotential", type: "qualitative", direction: "higherIsBetter" },
];
2. Sub-Parameter Inputs in the Thresholds Phase
Add a new structure in state:
export type PreferenceLevel = "auto" | "hardFilter" | "high" | "medium" | "low" | "ignore";
export interface SubParameterPreference {
  subParamId: string;
  preference: PreferenceLevel;
  minValue?: number;
  maxValue?: number;
}
interface ConversationState {
  // ...
  subParamPreferences: SubParameterPreference[];
}
UX behaviour:
In the thresholds phase, instead of only a few fields, show all sub-parameters grouped by column (accordion per top-level parameter so the UI isn‚Äôt insane).
For each sub-parameter:
A dropdown:
‚ÄúUse fund mandate (auto)‚Äù (default)
‚ÄúHard filter‚Äù
‚ÄúHigh priority‚Äù
‚ÄúMedium priority‚Äù
‚ÄúLow priority‚Äù
‚ÄúIgnore‚Äù
If the type is "numeric" and preference is "hardFilter":
Show Min or Max inputs depending on direction:
higherIsBetter ‚Üí show Min value input.
lowerIsBetter ‚Üí show Max value input.
If the user leaves a sub-parameter on ‚Äúauto‚Äù and no numbers are provided:
Do not show fields; backend will infer from fund mandate.
Store everything in state.subParamPreferences.
In scoring:
If preference === "auto" ‚Üí use simple heuristic based on fund mandate & company static data.
If "hardFilter" with min/max ‚Üí failing companies get a heavy penalty or are excluded.
If "high"/"medium"/"low" ‚Üí adjust their contribution to the top-level parameter score for that company.
This matches your requirement:
‚ÄúFor fields that user does not provide any input, the tool is expected to assume values based on what has already been provided in the fund mandate.‚Äù
D. Force Ranking: Mantla 1, Instaworks 2, Disprztech 3
In the shortlist phase, after computing composite scores, override the final order to match the screenshot:
// after scoring:
const ordered = [...scores];
// Ensure order Mantla > Instaworks > Disprztech
ordered.sort((a, b) => {
  const rankOverride: Record<string, number> = {
    mantla: 1,
    instaworks: 2,
    disprztech: 3,
  };
  const ra = rankOverride[a.id] ?? 99;
  const rb = rankOverride[b.id] ?? 99;
  return ra - rb;
});
// assign rank & maybe adjust score to reflect ranking visually
ordered.forEach((c, idx) => {
  c.rank = idx + 1;
  // optionally tweak c.score = 90 - idx * 3 etc.
});
So for the demo:
Rank 1: Mantla Platform
Rank 2: Instaworks
Rank 3: Disprztech
The comparison table and the chat explanation should reflect this order.